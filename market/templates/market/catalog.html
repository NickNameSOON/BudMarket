<!DOCTYPE html>
{% extends "market/base.html" %}
{% load static %}

{% block content %}
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </head>
    <div class="mx-auto shadow-lg sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row-reverse">
            <!-- Sidebar for Category and Brand Selection -->
            <aside id="sidebar">
                <!-- Sorting Form -->
                <form method="get" action="{% url 'market:catalog' %}" class="sticky top-20 py-4">
                    <h1 class="text-3xl font-bold text-center mb-5">Фільтри: </h1>
                    <fieldset class="mt-2 mb-2">
                        <legend class="text-2xl mb-4">Сортувати за ціною:</legend>
                        <div class="flex items-center mb-1">
                            <input type="radio" id="no_sort" name="sort" value="" class="mr-2"
                                   {% if not sort_param %}checked{% endif %}>
                            <label for="no_sort">Без сортування</label>
                        </div>
                        <div class="flex items-center mb-1">
                            <input type="radio" id="min_price" name="sort" value="min_price" class="mr-2"
                                   {% if sort_param == 'min_price' %}checked{% endif %}>
                            <label for="min_price">Мінімальна ціна</label>
                        </div>
                        <div class="flex items-center mb-1">
                            <input type="radio" id="max_price" name="sort" value="max_price" class="mr-2"
                                   {% if sort_param == 'max_price' %}checked{% endif %}>
                            <label for="max_price">Максимальна ціна</label>
                        </div>
                    </fieldset>
                    <div class="mb-2">
                        <h3 class="text-2xl mb-4">Категорії</h3>
                        <div class="space-y-2">
                            {% for c in categories %}
                                <div class="flex items-center">
                                    <input type="radio" id="{{ c.slug }}" name="category" value="{{ c.slug }}"
                                           class="mr-2" {% if c.slug == category.slug %}checked{% endif %}>
                                    <label for="{{ c.slug }}">{{ c.name }}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <h3 class="text-2xl mb-4">Бренди</h3>
                    <div class="space-y-2">
                        {% for brand in brands %}
                            <div class="flex items-center">
                                <input type="checkbox" id="brand-{{ brand.brand }}" name="brand"
                                       value="{{ brand.brand }}" class="mr-2"
                                        {% if brand.brand in selected_brands %} checked {% endif %}>
                                <label for="brand-{{ brand.brand }}">{{ brand.brand }} ({{ brand.count }})</label>
                            </div>
                        {% endfor %}
                    </div>
                    <button class="mt-4 w-full bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded"
                            type="submit">Фільтрувати
                    </button>
                    <a class="text-red-700 text-center" href="{% url 'market:catalog' %}">Скинути</a>
                </form>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1">
                <div class="text-center mt-3 m-2">
                    <h2 class="text-4xl font-extrabold text-gray-900">Каталог</h2>
                </div>
                <!-- Search Form -->
                <form method="get" action="{% url 'market:catalog' %}"
                      class="flex justify-center items-center my-2 mx-16">
                    <div class="flex border-2 border-gray-300 focus-within:border-green-500 focus-within:ring focus-within:ring-green-200 rounded-lg shadow-sm overflow-hidden">
                        <input type="text" name="q" placeholder="Пошук за назвою" value="{{ query }}"
                               class="my-2 mx-16 w-full focus:outline-none text-lg">
                        <button type="submit"
                                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-r-lg flex items-center justify-center">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>

                <!-- Products Grid -->
                <div class="p-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">
                    {% for product in products %}
                        <a href="{% url 'market:detail' product.id %}"
                           class="block rounded overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-200">
                            <img class="w-full h-48 object-cover" src="{{ product.image.url }}" alt="">
                            <div class="px-6 py-4">
                                <p class="font-bold text-xl mb-2">{{ product.title }}</p>
                                <p class="text-lg text-gray-400 mb-2">Виробник: {{ product.brand }}</p>
                                <p class="font-bold text-xl text-green-500">{{ product.price }} ₴</p>
                            </div>
                        </a>
                    {% empty %}
                        <div class="text-4xl font-extrabold text-gray-900">Товари не знайдено</div>
                    {% endfor %}
                </div>
                <!-- Pagination -->
                <div class="pagination text-center">
                    <span class="step-links">
                        {% if products.has_previous %}
                            <a href="?page=1{% if query %}&q={{ query }}{% endif %}">&laquo; перша</a>
                            <a href="?page={{ products.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">попередня</a>
                        {% endif %}

                        <span class="current">
                            Сторінка {{ products.number }} з {{ products.paginator.num_pages }}
                        </span>

                        {% if products.has_next %}
                            <a href="?page={{ products.next_page_number }}{% if query %}&q={{ query }}{% endif %}">наступна</a>
                            <a href="?page={{ products.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}">остання &raquo;</a>
                        {% endif %}
                    </span>
                </div>
            </main>
        </div>
    </div>
{% endblock content %}